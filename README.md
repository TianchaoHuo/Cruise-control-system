# Cruise control system
 
## Overviews
This article presents the design process of the cruise controller and briefly analysis the performance of different control approaches including P, PI, and PID. A robust cruise control system is critical not only in automobile fields but also in manufacturing fields and the aerospace industry. Using MATLAB to test the outcome of different control methods can visually and directly validate the feedback control model.
<!--more-->

repo: https://github.com/TianchaoHuo/Cruise-control-system

## Objective
Design a cruise controller for a BMW 335i car. The specifications of this vehicle are:

<div align=center><img src = "An-Introduction-of-Cruise-Control-System\specifications.jpg"></div>



## Modeling the cruise control system
### Introduction of PID control
The overall control function can be expressed mathematically as:
$$
u(t) = K_pe(t)+K_i\int_{0}^{t}{e(T)dT +K_d\frac{de(t)}{dt} } \tag{1}
$$
where $K_p$, $K_i$, and  $K_d$, all non-negative, denote the coefficients for the proportional, integral, and derivative terms respectively. PID control family basically consists of P, PI, PD, and PID control, and these control methods will be selected according to the system
### Model the free body diagram and EOMs
To model the cruise control system, it is important to find some technical specifications of a car as it is a practical design project.
<div align=center><img src = "An-Introduction-of-Cruise-Control-System\model.jpg"></div>

#### equations of motion(EOMs)
Let v be the speed of the car, m the gross vehicle mass. Therefore, the EMOs is simply
$$
m\frac{dv}{dt}=F-f \tag{2}
$$
The F is the driving force generated by the engine and f is the aerodynamic drag, which is proportional to the square of the speed:
$$
f=\frac{1}{2}A\rho C_d v^2 \tag{3}
$$

where $\rho$ is the density of air in $kg/m^3$ , $C_d$ is the dimensionless aerodynamic drag coefficient and A is the cross-sectional area of the car in $m^2$(looking from the front). Looking through [1], we can obtain parameter $œÅ= 1.2041$, $C_d = 0.3$, m = 2020kg and A = 2.1$m^2$

To summarize, we find that the car can be modeled by
$$
m\dot{v}+ \frac{1}{2}A\rho c_Dv^2 = F + d \tag{4}
$$
where $d$, which represents constant disturbance, is zero initially in this paper and when finishing the controller design, we will investigate how the controller is influenced in terms of unknown disturbance.

#### linearize the equations of motion
Obviously, the above equation is non-linear as it has square and therefore, we need to linearize this equation. This behavior is to investigate the local behavior of a system, where the non-linear effects are expected to small. In this section, we are currently discussing how to locally approximate a system by its linearization. Firstly, we rearrange the equations and make the m $\dot{v}$ equal to zero, which can find the equilibrium points of the equations. Through calculating, we can know that any point can be equilibrium points in this system model. Hence, it is assumed that $(V_0, F_0)$ is an equilibrium point used in this model, where $V_0 = 100m/s$ and $F_0$ is approximately equal to 3600. So, using the following linearize equation from [2]:

$$
 f(v,F)\ \approx\ f(V_0,F_0)\ + \frac{\partial f}{\partial v}(V_0,F_0)(V-V_0)+\frac{\partial f}{\partial F}(V_0,F_0)(F-F_0) \tag{5}
$$
we eventually can get a linearized equation of the system model:
$$
 m\dot{\delta_v} = F -A\rho\ c_Dv_0\delta_v-\ F_0 \tag{6}
$$
where $\delta_v$ is the difference value of the velocity of the car. Now, it is better to change the equation variable to make the equation more understandable. Hence, we replace the  $\delta_v $with $x$. Moreover, it is computable for the coeffects of $\delta_v $ with the parameters we described above. Eventually, we can rearrange it and approximately write the linearized equation of this model:
$$
2020\dot{x(t)} + 72x(t)= u(t) \tag{7}
$$
where $u(t)$ is the input of this system, representing the sum of the input $F$ and  $F_0$. Currently we have the linear system model so that we can proceed to the next step, the controller design.

## Design process


### Proportional control
Initially, we start designing from P control, which is the fundamental step for PID control. The P control is also named proportional control majorly used to correct the error between the set value and process value. Obviously, this is the feedback control continuously feeding the output of the system back to the input of the system with the error between the current output value and the reference value.
<div align=center><img src = "An-Introduction-of-Cruise-Control-System\P control.jpg"></div>

Knowing from the above figure, the output of a proportional controller is the multiplication product of the error signal and the proportional gain $Kp$. Therefore, combining with the equation 7, the mathematical model of cruise controller using P control is expressed as:
$$
2020\dot{x(t)}+(72+K_p)x(t)=K_pr(t) \tag{8}
$$

where $r(t)$ is reference speed set by customers and $x(t)$ is the present velocity of vehicles. It is apparent that equation 8 is a linear system and we can obtain $K_p$ by specifying reference speed and specifications shown in Table 1. In this section, reference speed is 100$km/h$. Through calculating, we can obtain the $K_p$ value, which is at least greater than 962 and then using MATLAB to simulate the performance of the system.

<div align=center><img src = "An-Introduction-of-Cruise-Control-System\P_result.jpg"></div>

It is evident that the final value of a proportional controller is over the permitted error range 1%, which cannot meet practical specifications. It also means that there is a steady-state error using this controlling approach. The reason will be analyzed in the discussion part.  In order to eliminate steady-state error and finally reach the desired speed, we are planning to introduce an integral control method in this project, which is effectively correcting the error.

### Proportional and integral control
Basing on the above design, we are currently introducing integral control in this section. Integral control in a PID controller is the sum of the instantaneous error over time and gives the accumulated offset that should have been corrected previously. The integral term accelerates the movement of the movement of the process towards reference value and eliminates the residual steady-state error that occurs with a pure proportional controller.

<div align=center><img src = "An-Introduction-of-Cruise-Control-System\PI control.jpg"></div>

From the above Figure , we know that the accumulated error is multiplied by the integral gain Ki and then added with proportional value to input cruise controller. Hence, combining with the equation 7, we can now mathematically obtain the PI control model, which is expressed as:


$$
2020\dot{x}=K_p\left(r\left(t\right)-x\left(t\right)\right)+K_i\int_{0}^{t}\left(r\left(T\right)-x\left(T\right)\right)dT-72x \tag{9}
$$


where $r(t)$ is reference speed set by customers and $x(t)$ is the velocity of vehicles as time goes. It is obvious that equation 9 is a linear system and after derivation,  we can obtain $K_p$ and $K_i$ by specifying the reference speed and specifications shown in the table shown above. In this section, reference speed is 100$km/h$. Through calculating, we can obtain the $K_p$ and $K_i$ value, which are assigned 1800 and 600 here, respectively. And then using MATLAB to simulate the performance of the system, as shown in the following:

<div align=center><img src = "An-Introduction-of-Cruise-Control-System\PI_result.jpg"></div>


It can be seen that this PI control is better than pure P control since it has fantastic performance on eliminating the steady-state error. Moreover, it also fulfills the specifications demand that we specify in the above table , which not only can final value reach the desired speed 100$km/h$, but also can the overshoot and rise time meet the requirements defined in the above table.


## Validation
This section is to explain and validate the result of the designed controller. It is quite significant to do validations to confirm that the controller should appropriately work under required conditions. Firstly, by changing the mass of the vehicle, probably equal to the total weight of several passengers plus gross vehicle mass, we examine the effect of uncertainty in mass. Moreover, the designed controller, PI controller, is examined under the dynamics of changing from one target speed to another, for example, 60,80,110, and 30 $km/h$. Finally, the constant disturbance caused by a sudden transition from flat ground to a very steep uphill slope of 5% grade is introduced into this controller.

### performance of the controller under uncertainty in mass
As we known, sometime there might be several passengers in a vehicle over the journey. Therefore, it is necessary to consider the effect of uncertainty in mass. In order to test this performance of controller, we are now assuming that the average weight of each passenger is 70 kg and the maximum number of seats of the car are 5. Based on these assumptions, we put five passengers into the vehicle, which definitely influence the gross vehicle mass (GVM), to assess the reaction of the controller. So, in this way, using MATLAB, we can visually show the outcome of the controller, as shown in the following:

<div align=center><img src = "An-Introduction-of-Cruise-Control-System\validation_1.jpg"></div>


it is clear that the car finally can reach the desired speed, whether with five passengers, or not. However, there is some difference in settling time and overshoot. The reason why it happens will be stated in the report. And you can refer to the report at the repo.


### performance of the controller under changing velocity conditions
To examine the performance under the different velocity, we are going to increase and decrease velocity randomly. For example, the reference velocity initially is set to 100km/h and then decreased to 80, 60, 40 km/h respectively, and finally surged to 120km/h. In this way, we can figure out the output of controller on changing velocity.
Therefore, in this section, utilizing the MATLAB software, by changing the setpoint, we can visually obtain the performance on changing velocity, as shown in the following:


<div align=center><img src = "An-Introduction-of-Cruise-Control-System\validation_2.jpg"></div>

Obviously, the car can precisely and smoothly reach the desired velocity whatever the reference speed decreases or increases. Through this examination, it is confirmed that the designed controller can work in any reasonable velocity.


### performance of the controller under constant disturbance conditions
In this part, the constant disturbance is introduced into the controller. Firstly, it is necessary to know that the disturbance for vehicle assumed in this paper is generated from a sudden transition from flat ground to a very certain steep uphill slope. For a robust controller, the critical thing is to work accurately even though there is some disturbance.
Hence, we assume that the car is driven in 100$km/h$ on the flat ground but suddenly is driven on a steep uphill slope of 35% grade, which will create a constant disturbance. According to Newton‚Äôs second law of motion, we can obtain that the constant disturbance in this assumption is equal to $mgsinŒ∏$. The below figure displays the free body diagram of the car on an uphill slope:



<div align=center><img src = "An-Introduction-of-Cruise-Control-System\car_2.jpg"></div>



Because the car is suddenly driven to an uphill slope from flat ground, the previous balance of maintaining desired speed is broken. In order to keep the desired speed, the force generated by the engine of the car needs to be increased.  Going backing to the original equation 4, it is time to introduce the disturbance in this system. Obtaining from the above analysis, we can obtain the equation:
$$
 m\dot{v}+ \frac{1}{2}A\rho c_Dv^2 = F - mgsin\theta \tag{10}
$$

where $g$ is the gravity of earth, and other remaining variables are explained in the above discussion. Therefore, from a practical perspective, $\theta$ is limited and we select 5 degree in this paper.

Through calculating, when maintaining the speed 100$km/h$, the force 3780$N$is needed to be generated from the car engine. Nevertheless, the magnitude of disturbance, mgsin$\theta$, is 1725$N$ approximately, which is nearly half of balance force in 100$Km/h$. Hence, it obvious that this disturbance highly influences the system and velocity, as shown in the below:



<div align=center><img src = "An-Introduction-of-Cruise-Control-System\validation_3.jpg"></div>


we can clearly see that the velocity of car sharply decreases because of the disturbance but finally the speed can reach the desired speed even though the driving force that generated by the engine is enormous suddenly and then gradually approaches to 5505$N$.




## Conclusions
This article mainly discusses the design of a cruise controller, containing linearization for the non-linear model, the introduction of PID control, the designing process of cruise controller. Basically, we start from P control method and analyze the performance. However, there is a steady-state error so that we move to design PI control, which is effective to eliminate the steady-state error. It also mathematically analyzes why we select proportional and integral control method, rather than pure proportional control. Moreover, examinations under several conditions are provided to test the performance of the designed controller, for example, changing target speed to another,  suddenly changing from flat ground to steep uphill slope.  From these examinations, we understand that how the mass influences the response of the controller and why we cannot select a high value of proportional gain.
In conclusion, this article provides an example to design a cruise controller. More discussion you can refer to the report.


## REFERENCES
[1]	Bmw.co.za, 2018. [Online]. Available:
https://app.bmw.co.za/dws/VTS/servlet/VtsPdfUI?modelCode=KG72.  [Accessed: 15- Sep- 2018]. </br>
[2]	G. Shi, 2018. [Online]. Available:
https://wattlecourses.anu.edu.au/pluginfile.php/1816532/mod_resource/content/1/Notes_Wk4.pdf. [Accessed: 16- Sep- 2018].</br>
[3]	K. AstroÃàm and R. Murray, An Feedback systems : an introduction for scientists and engineers. Princeton University Press, 2010.</br>
[4]	O. Garpinger et al, "Performance and robustness trade-offs in PID control," Journal of Process Control, vol. 24, (5), pp. 568-577, 2014.
